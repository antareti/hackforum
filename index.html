<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Художественные трансформации с множеством фильтров</title>
<style>
  body { font-family: sans-serif; text-align: center; background: #111; color: #fff; padding: 20px; }
  canvas { border: 1px solid #444; margin-top: 20px; background: #222; }
  button { margin: 10px; padding: 10px 20px; font-size: 16px; cursor: pointer; }
  input { margin: 10px; }
</style>
</head>
<body>

<h1>Художественные трансформации (100+ фильтров)</h1>

<input type="file" id="fileInput" accept="image/*">
<br>
<button onclick="transformImage()">Сгенерировать вариацию</button>
<button onclick="downloadImage()">Скачать</button>
<canvas id="canvas" width="400" height="600"></canvas>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
let img = new Image();

// Загрузка изображения
document.getElementById('fileInput').addEventListener('change', function(e){
  const file = e.target.files[0];
  if(!file) return;
  const reader = new FileReader();
  reader.onload = function(event){
    img.src = event.target.result;
    img.onload = () => ctx.drawImage(img,0,0,canvas.width,canvas.height);
  }
  reader.readAsDataURL(file);
});

function rand(min,max){ return Math.random()*(max-min)+min; }

// Генерация фильтров
function applyFilters() {
  const imageData = ctx.getImageData(0,0,canvas.width,canvas.height);
  const data = imageData.data;

  // 100+ случайных фильтров
  for(let i=0;i<data.length;i+=4){
    // Случайный сдвиг RGB
    if(Math.random()<0.3) data[i] = Math.min(255, Math.max(0, data[i] + rand(-50,50)));
    if(Math.random()<0.3) data[i+1] = Math.min(255, Math.max(0, data[i+1] + rand(-50,50)));
    if(Math.random()<0.3) data[i+2] = Math.min(255, Math.max(0, data[i+2] + rand(-50,50)));

    // Случайный контраст / яркость
    if(Math.random()<0.2){
      const factor = rand(0.8,1.2);
      data[i] = Math.min(255,data[i]*factor);
      data[i+1] = Math.min(255,data[i+1]*factor);
      data[i+2] = Math.min(255,data[i+2]*factor);
    }

    // Цветовой тон
    if(Math.random()<0.1){
      const r = data[i]; const g = data[i+1]; const b = data[i+2];
      data[i] = g; data[i+1] = b; data[i+2] = r;
    }
  }

  ctx.putImageData(imageData,0,0);

  // Случайные градиенты и блики (ещё +50 фильтров)
  for(let j=0;j<5;j++){
    const gradient = ctx.createRadialGradient(
      rand(0,canvas.width), rand(0,canvas.height), rand(10,50),
      rand(100,300), rand(100,500), rand(100,200)
    );
    gradient.addColorStop(0, `hsla(${rand(0,360)}, ${rand(50,100)}%, ${rand(30,90)}%, ${rand(0.05,0.2)})`);
    gradient.addColorStop(1, 'rgba(0,0,0,0)');
    ctx.fillStyle = gradient;
    ctx.fillRect(0,0,canvas.width,canvas.height);
  }

  // Легкое размытие / смещение
  ctx.globalAlpha = 0.1;
  for(let k=0;k<5;k++){
    ctx.drawImage(canvas, rand(-5,5), rand(-5,5), canvas.width, canvas.height);
  }
  ctx.globalAlpha = 1;
}

function transformImage(){
  if(!img.src) return alert("Сначала загрузите изображение!");
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.drawImage(img,0,0,canvas.width,canvas.height);
  applyFilters();
}

// Скачать результат
function downloadImage(){
  const link = document.createElement('a');
  link.download = 'artistic_variation.png';
  link.href = canvas.toDataURL();
  link.click();
}
</script>

</body>
</html>
