<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Художественные трансформации с загрузкой</title>
<style>
  body { font-family: sans-serif; text-align: center; background: #111; color: #fff; padding: 20px; }
  canvas { border: 1px solid #444; margin-top: 20px; background: #222; }
  button { margin: 10px; padding: 10px 20px; font-size: 16px; cursor: pointer; }
  input { margin: 10px; }
</style>
</head>
<body>

<h1>Художественные трансформации изображения</h1>

<input type="file" id="fileInput" accept="image/*">
<br>
<button onclick="transformImage()">Сгенерировать вариацию</button>
<button onclick="downloadImage()">Скачать</button>
<canvas id="canvas" width="400" height="600"></canvas>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
let img = new Image(); // текущее изображение

// Загрузка изображения с компьютера
document.getElementById('fileInput').addEventListener('change', function(e){
  const file = e.target.files[0];
  if(!file) return;
  const reader = new FileReader();
  reader.onload = function(event){
    img.src = event.target.result;
    img.onload = () => {
      ctx.clearRect(0,0,canvas.width,canvas.height);
      ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
    }
  }
  reader.readAsDataURL(file);
});

function rand(min,max){ return Math.random()*(max-min)+min; }

// Применение художественных трансформаций
function transformImage() {
  if(!img.src) return alert("Сначала загрузите изображение!");
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // Случайный цветовой фильтр
  const rShift = Math.floor(rand(-30,30));
  const gShift = Math.floor(rand(-30,30));
  const bShift = Math.floor(rand(-30,30));

  // Отрисовка изображения
  ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

  // Работа с пикселями
  const imageData = ctx.getImageData(0,0,canvas.width,canvas.height);
  const data = imageData.data;
  for(let i=0;i<data.length;i+=4){
    data[i] = Math.min(255, Math.max(0, data[i]+rShift));     
    data[i+1] = Math.min(255, Math.max(0, data[i+1]+gShift)); 
    data[i+2] = Math.min(255, Math.max(0, data[i+2]+bShift)); 
  }
  ctx.putImageData(imageData,0,0);

  // Мягкий световой блик
  const gradient = ctx.createRadialGradient(
    rand(50,350),
    rand(50,300),
    30,
    canvas.width/2,
    canvas.height/2,
    200
  );
  gradient.addColorStop(0,'rgba(255,255,255,0.2)');
  gradient.addColorStop(1,'rgba(255,255,255,0)');
  ctx.fillStyle = gradient;
  ctx.fillRect(0,0,canvas.width,canvas.height);

  // Легкое размытие для художественного эффекта
  ctx.globalAlpha = 0.1;
  for(let i=0;i<3;i++){
    ctx.drawImage(canvas, rand(-5,5), rand(-5,5), canvas.width, canvas.height);
  }
  ctx.globalAlpha = 1;
}

// Скачать результат
function downloadImage(){
  const link = document.createElement('a');
  link.download = 'artistic_variation.png';
  link.href = canvas.toDataURL();
  link.click();
}
</script>

</body>
</html>
